(()=>{"use strict";var t,i={9521:(t,i,s)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CCSettings=i.ActionMap=i.ActionData=i.CharacterController=void 0;const e=s(573);i.CharacterController=class{constructor(t,i,s,n,o=!1){this._avatar=null,this._skeleton=null,this._gravity=9.8,this._minSlopeLimit=30,this._maxSlopeLimit=45,this._sl1=Math.PI*this._minSlopeLimit/180,this._sl2=Math.PI*this._maxSlopeLimit/180,this._stepOffset=.25,this._vMoveTot=0,this._vMovStartPos=e.Vector3.Zero(),this._actionMap=new h,this._cameraElastic=!0,this._cameraTarget=e.Vector3.Zero(),this._noFirstPerson=!1,this._mode=0,this._saveMode=0,this._isRHS=!1,this._signRHS=-1,this._started=!1,this._stopAnim=!1,this._prevAnim=null,this._avStartPos=e.Vector3.Zero(),this._grounded=!1,this._freeFallDist=0,this._fallFrameCountMin=50,this._fallFrameCount=0,this._inFreeFall=!1,this._wasWalking=!1,this._wasRunning=!1,this._jumpStartPosY=0,this._jumpTime=0,this._movFallTime=0,this._sign=1,this._isTurning=!1,this._noRot=!1,this._idleFallTime=0,this._groundFrameCount=0,this._groundFrameMax=10,this._savedCameraCollision=!0,this._inFP=!1,this._ray=new e.Ray(e.Vector3.Zero(),e.Vector3.One(),1),this._rayDir=e.Vector3.Zero(),this._cameraSkin=.5,this._skip=0,this._move=!1,this._isAG=!1,this._hasAnims=!1,this._camera=i,this._scene=s,this.setAvatar(t,o)||console.error("unable to set avatar");let r=null;null!=n&&this.setActionMap(n),this._isAG||null==this._skeleton||this._checkAnimRanges(this._skeleton),this._isAG,this._savedCameraCollision=this._camera.checkCollisions,this._act=new a,this._renderer=()=>{this._moveAVandCamera()},this._handleKeyUp=t=>{this._onKeyUp(t)},this._handleKeyDown=t=>{this._onKeyDown(t)}}getScene(){return this._scene}setSlopeLimit(t,i){this._minSlopeLimit=t,this._maxSlopeLimit=i,this._sl1=Math.PI*this._minSlopeLimit/180,this._sl2=Math.PI*this._maxSlopeLimit/180}setStepOffset(t){this._stepOffset=t}setWalkSpeed(t){this._actionMap.walk.speed=t}setRunSpeed(t){this._actionMap.run.speed=t}setBackSpeed(t){this._actionMap.walkBack.speed=t}setBackFastSpeed(t){this._actionMap.walkBackFast.speed=t}setJumpSpeed(t){this._actionMap.idleJump.speed=t,this._actionMap.runJump.speed=t}setLeftSpeed(t){this._actionMap.strafeLeft.speed=t}setLeftFastSpeed(t){this._actionMap.strafeLeftFast.speed=t}setRightSpeed(t){this._actionMap.strafeRight.speed=t}setRightFastSpeed(t){this._actionMap.strafeLeftFast.speed=t}setTurnSpeed(t){this._actionMap.turnLeft.speed=t*Math.PI/180,this._actionMap.turnRight.speed=t*Math.PI/180}setTurnFastSpeed(t){this._actionMap.turnLeftFast.speed=t*Math.PI/180,this._actionMap.turnRightFast.speed=t*Math.PI/180}setGravity(t){this._gravity=t}setAnimationGroups(t){null!=this._prevAnim&&this._prevAnim.exist&&this._prevAnim.ag.stop(),this._isAG=!0,this.setActionMap(t)}setAnimationRanges(t){this._isAG=!1,this.setActionMap(t)}setActionMap(t){let i,s=!1,a=Object.keys(this._actionMap);for(let h of a){let a=this._actionMap[h];a instanceof n&&(a.exist=!1,i=t[a.id],null!=i&&(i instanceof e.AnimationGroup?(a.ag=i,a.name=a.ag.name,a.exist=!0,s=!0,this._hasAnims=!0):i.exist&&(this._hasAnims=!0,a.exist=!0,i instanceof Object?(i.ag&&(a.ag=i.ag,s=!0),i.name&&(a.name=i.name),null!=i.loop&&(a.loop=i.loop),i.rate&&(a.rate=i.rate),i.speed&&(a.speed=i.speed),i.sound&&(a.sound=i.sound)):a.name=i)))}return this._checkFastAnims(),this._prevAnim=null,s?"ag":"ar"}getActionMap(){let t=new h,i=Object.keys(this._actionMap);for(let s of i){let i=this._actionMap[s];if(!(i instanceof n))continue;if(!i.exist)continue;let e=t[i.id];e.ag=i.ag,e.name=i.name,e.loop=i.loop,e.rate=i.rate,e.speed=i.speed,e.key=i.key,e.sound=i.sound,e.exist=i.exist}return t}getSettings(){let t=new o;return t.faceForward=this.isFaceForward(),t.topDown=1==this.getMode(),t.turningOff=this.isTurningOff(),t.cameraTarget=this._cameraTarget.clone(),t.cameraElastic=this._cameraElastic,t.gravity=this._gravity,t.keyboard=this._ekb,t.maxSlopeLimit=this._maxSlopeLimit,t.minSlopeLimit=this._minSlopeLimit,t.noFirstPerson=this._noFirstPerson,t.stepOffset=this._stepOffset,t}setSettings(t){this.setFaceForward(t.faceForward),this.setMode(t.topDown?1:0),this.setTurningOff(t.turningOff),this.setCameraTarget(t.cameraTarget),this.setCameraElasticity(t.cameraElastic),this.setGravity(t.gravity),this.enableKeyBoard(t.keyboard),this.setSlopeLimit(t.minSlopeLimit,t.maxSlopeLimit),this.setNoFirstPerson(t.noFirstPerson),this.setStepOffset(t.stepOffset)}_setAnim(t,i,s,a){if(this._isAG||null!=this._skeleton){if(null!=i)if(this._isAG){if(!(i instanceof e.AnimationGroup))return;t.ag=i,t.exist=!0}else{if(null==this._skeleton.getAnimationRange(t.name))return void(t.exist=!1);t.name=i,t.exist=!0}null!=a&&(t.loop=a),null!=s&&(t.rate=s)}}enableBlending(t){if(this._isAG){let i=Object.keys(this._actionMap);for(let s of i){let i=this._actionMap[s];if(i instanceof n&&i.exist){let s=i.ag;for(let i of s.targetedAnimations)i.animation.enableBlending=!0,i.animation.blendingSpeed=t}}}else null!==this._skeleton&&this._skeleton.enableBlending(t)}disableBlending(){if(this._isAG){let t=Object.keys(this._actionMap);for(let i of t){let t=this._actionMap[i];if(t instanceof n&&t.exist){let i=t.ag;for(let t of i.targetedAnimations)t.animation.enableBlending=!1}}}}setWalkAnim(t,i,s){this._setAnim(this._actionMap.walk,t,i,s)}setRunAnim(t,i,s){this._setAnim(this._actionMap.run,t,i,s)}setWalkBackAnim(t,i,s){this._setAnim(this._actionMap.walkBack,t,i,s),this._copySlowAnims(this._actionMap.walkBackFast,this._actionMap.walkBack)}setWalkBackFastAnim(t,i,s){this._setAnim(this._actionMap.walkBackFast,t,i,s)}setSlideBackAnim(t,i,s){this._setAnim(this._actionMap.slideBack,t,i,s)}setIdleAnim(t,i,s){this._setAnim(this._actionMap.idle,t,i,s)}setTurnRightAnim(t,i,s){this._setAnim(this._actionMap.turnRight,t,i,s),this._copySlowAnims(this._actionMap.turnRightFast,this._actionMap.turnRight)}setTurnRightFastAnim(t,i,s){this._setAnim(this._actionMap.turnRightFast,t,i,s)}setTurnLeftAnim(t,i,s){this._setAnim(this._actionMap.turnLeft,t,i,s),this._copySlowAnims(this._actionMap.turnLeftFast,this._actionMap.turnLeft)}setTurnLeftFastAnim(t,i,s){this._setAnim(this._actionMap.turnLeftFast,t,i,s)}setStrafeRightAnim(t,i,s){this._setAnim(this._actionMap.strafeRight,t,i,s),this._copySlowAnims(this._actionMap.strafeRightFast,this._actionMap.strafeRight)}setStrafeRightFastAnim(t,i,s){this._setAnim(this._actionMap.strafeRightFast,t,i,s)}setStrafeLeftAnim(t,i,s){this._setAnim(this._actionMap.strafeLeft,t,i,s),this._copySlowAnims(this._actionMap.strafeLeftFast,this._actionMap.strafeLeft)}setStrafeLeftFastAnim(t,i,s){this._setAnim(this._actionMap.strafeLeftFast,t,i,s)}setIdleJumpAnim(t,i,s){this._setAnim(this._actionMap.idleJump,t,i,s)}setRunJumpAnim(t,i,s){this._setAnim(this._actionMap.runJump,t,i,s)}setFallAnim(t,i,s){this._setAnim(this._actionMap.fall,t,i,s)}setWalkKey(t){this._actionMap.walk.key=t.toLowerCase()}setWalkBackKey(t){this._actionMap.walkBack.key=t.toLowerCase()}setTurnLeftKey(t){this._actionMap.turnLeft.key=t.toLowerCase()}setTurnRightKey(t){this._actionMap.turnRight.key=t.toLowerCase()}setStrafeLeftKey(t){this._actionMap.strafeLeft.key=t.toLowerCase()}setStrafeRightKey(t){this._actionMap.strafeRight.key=t.toLowerCase()}setJumpKey(t){this._actionMap.idleJump.key=t.toLowerCase()}setCameraElasticity(t){this._cameraElastic=t}setCameraTarget(t){this._cameraTarget.copyFrom(t)}cameraCollisionChanged(){this._savedCameraCollision=this._camera.checkCollisions}setNoFirstPerson(t){this._noFirstPerson=t}_checkAnimRanges(t){let i=Object.keys(this._actionMap);for(let s of i){let i=this._actionMap[s];i instanceof n&&(null!=t?null!=t.getAnimationRange(i.id)&&(i.name=i.id,i.exist=!0,this._hasAnims=!0):i.exist=!1)}this._checkFastAnims()}_checkFastAnims(){this._copySlowAnims(this._actionMap.walkBackFast,this._actionMap.walkBack),this._copySlowAnims(this._actionMap.turnRightFast,this._actionMap.turnRight),this._copySlowAnims(this._actionMap.turnLeftFast,this._actionMap.turnLeft),this._copySlowAnims(this._actionMap.strafeRightFast,this._actionMap.strafeRight),this._copySlowAnims(this._actionMap.strafeLeftFast,this._actionMap.strafeLeft)}_copySlowAnims(t,i){t.exist||i.exist&&(t.exist=!0,t.ag=i.ag,t.name=i.name,t.rate=2*i.rate)}setMode(t){this._mode=t,this._saveMode=t}getMode(){return this._mode}setTurningOff(t){this._noRot=t}isTurningOff(){return this._noRot}_setRHS(t){const i=t.getWorldMatrix(),s=e.Vector3.FromFloatArray(i.m,0),a=e.Vector3.FromFloatArray(i.m,4),n=e.Vector3.FromFloatArray(i.m,8),h=e.Vector3.Cross(s,a);e.Vector3.Dot(h,n)<0?(this._isRHS=!0,this._signRHS=1):(this._isRHS=!1,this._signRHS=-1)}setFaceForward(t){this._ff=t,this._isRHS?(this._av2cam=t?Math.PI/2:3*Math.PI/2,this._ffSign=t?1:-1):(this._av2cam=t?3*Math.PI/2:Math.PI/2,this._ffSign=t?-1:1)}isFaceForward(){return this._ff}checkAGs(t){let i=Object.keys(this._actionMap);for(let s of i){let i=this._actionMap[s];i instanceof n&&null!=t[i.name]&&(i.ag=t[i.name],i.exist=!0)}}_containsAG(t,i,s){let a,n;s?(a=this._getRoot(t),n=a.getChildren((t=>t instanceof e.TransformNode),!1)):(a=t,n=[a]);for(let t of i){let i=t.targetedAnimations;for(let t of i)if(n.indexOf(t.target)>-1)return!0}return!1}_getRoot(t){return null==t.parent?t:this._getRoot(t.parent)}start(){this._started||(this._started=!0,this._act.reset(),this._movFallTime=0,this._idleFallTime=.001,this._grounded=!1,this._updateTargetValue(),this.enableKeyBoard(!0),this._scene.registerBeforeRender(this._renderer))}stop(){this._started&&(this._started=!1,this._scene.unregisterBeforeRender(this._renderer),this.enableKeyBoard(!1),this._prevAnim=null)}pauseAnim(){this._stopAnim=!0}resumeAnim(){this._stopAnim=!1}_isAvFacingCamera(){return e.Vector3.Dot(this._avatar.forward,this._avatar.position.subtract(this._camera.position))<0?1:-1}_moveAVandCamera(){this._avStartPos.copyFrom(this._avatar.position);let t=null;const i=this._scene.getEngine().getDeltaTime()/1e3;this._act._jump&&!this._inFreeFall?(this._grounded=!1,this._idleFallTime=0,t=this._doJump(i)):this.anyMovement()||this._inFreeFall?(this._grounded=!1,this._idleFallTime=0,t=this._doMove(i)):this._inFreeFall||(t=this._doIdle(i)),!this._stopAnim&&this._hasAnims&&null!=t&&this._prevAnim!==t&&(t.exist&&(this._isAG?(null!=this._prevAnim&&this._prevAnim.exist&&this._prevAnim.ag.stop(),t.ag.start(t.loop,t.rate)):this._skeleton.beginAnimation(t.name,t.loop,t.rate)),this._prevAnim=t),this._updateTargetValue()}_doJump(t){let i=null;i=this._actionMap.runJump,0===this._jumpTime&&(this._jumpStartPosY=this._avatar.position.y),this._jumpTime=this._jumpTime+t;let s,a=0,n=0;if(1==this._mode||this._noRot||(this._avatar.rotation.y=this._av2cam-this._camera.alpha),this._wasRunning||this._wasWalking?(this._wasRunning?a=this._actionMap.run.speed*t:this._wasWalking&&(a=this._actionMap.walk.speed*t),s=this._moveVector.clone(),s.y=0,s=s.normalize(),s.scaleToRef(a,s),n=this._calcJumpDist(this._actionMap.runJump.speed,t),s.y=n):(n=this._calcJumpDist(this._actionMap.idleJump.speed,t),s=new e.Vector3(0,n,0),i=this._actionMap.idleJump),this._avatar.moveWithCollisions(s),n<0)if(this._avatar.position.y>this._avStartPos.y||this._avatar.position.y===this._avStartPos.y&&s.length()>.001)this._endJump();else if(this._avatar.position.y<this._jumpStartPosY){const t=this._avatar.position.subtract(this._avStartPos);this._areVectorsEqual(t,s,.001)?i=this._actionMap.fall:this._verticalSlope(t)<=this._sl1&&this._endJump()}return i}_calcJumpDist(t,i){return(t-this._gravity*this._jumpTime)*i-.5*this._gravity*i*i}_endJump(){this._act._jump=!1,this._jumpTime=0,this._wasWalking=!1,this._wasRunning=!1}_areVectorsEqual(t,i,s){return Math.abs(t.x-i.x)<s&&Math.abs(t.y-i.y)<s&&Math.abs(t.z-i.z)<s}_verticalSlope(t){return Math.atan(Math.abs(t.y/Math.sqrt(t.x*t.x+t.z*t.z)))}_doMove(t){const i=this._movFallTime*this._gravity;this._freeFallDist=i*t+this._gravity*t*t/2,this._movFallTime=this._movFallTime+t;let s=!1,e=null;if(this._inFreeFall)this._moveVector.y=-this._freeFallDist,s=!0;else{let i;this._wasWalking=!1,this._wasRunning=!1;let a=0;switch(!0){case this._act._stepLeft:i=this._signRHS*this._isAvFacingCamera(),a=this._actionMap.strafeLeft.speed*t,this._act._speedMod?(a=this._actionMap.strafeLeftFast.speed*t,e=-this._ffSign*i>0?this._actionMap.strafeLeftFast:this._actionMap.strafeRightFast):e=-this._ffSign*i>0?this._actionMap.strafeLeft:this._actionMap.strafeRight,this._moveVector=this._avatar.calcMovePOV(i*a,-this._freeFallDist,0),s=!0;break;case this._act._stepRight:i=-this._signRHS*this._isAvFacingCamera(),a=this._actionMap.strafeRight.speed*t,this._act._speedMod?(a=this._actionMap.strafeRightFast.speed*t,e=-this._ffSign*i>0?this._actionMap.strafeLeftFast:this._actionMap.strafeRightFast):e=-this._ffSign*i>0?this._actionMap.strafeLeft:this._actionMap.strafeRight,this._moveVector=this._avatar.calcMovePOV(i*a,-this._freeFallDist,0),s=!0;break;case this._act._walk||this._noRot&&0==this._mode:this._act._speedMod?(this._wasRunning=!0,a=this._actionMap.run.speed*t,e=this._actionMap.run):(this._wasWalking=!0,a=this._actionMap.walk.speed*t,e=this._actionMap.walk),this._moveVector=this._avatar.calcMovePOV(0,-this._freeFallDist,this._ffSign*a),s=!0;break;case this._act._walkback:a=this._actionMap.walkBack.speed*t,this._act._speedMod?(a=this._actionMap.walkBackFast.speed*t,e=this._actionMap.walkBackFast):e=this._actionMap.walkBack,this._moveVector=this._avatar.calcMovePOV(0,-this._freeFallDist,-this._ffSign*a),s=!0}}if((!this._noRot||0!=this._mode)&&!this._act._stepLeft&&!this._act._stepRight&&(this._act._turnLeft||this._act._turnRight)){let i=this._actionMap.turnLeft.speed*t;if(this._act._speedMod&&(i*=2),1==this._mode){this._isTurning||(this._sign=-this._ffSign*this._isAvFacingCamera(),this._isRHS&&(this._sign=-this._sign),this._isTurning=!0);let t=this._sign;this._act._turnLeft?this._act._walk||(this._act._walkback?t=-this._sign:e=this._sign>0?this._actionMap.turnRight:this._actionMap.turnLeft):this._act._walk?t=-this._sign:this._act._walkback||(t=-this._sign,e=this._sign>0?this._actionMap.turnLeft:this._actionMap.turnRight),this._avatar.rotation.y=this._avatar.rotation.y+i*t}else{let t=1;this._act._turnLeft?(this._act._walkback&&(t=-1),s||(e=this._actionMap.turnLeft)):(this._act._walk&&(t=-1),s||(t=-1,e=this._actionMap.turnRight)),this._camera.alpha=this._camera.alpha+i*t}}if(1!=this._mode)if(this._noRot)switch(!0){case this._act._walk&&this._act._turnRight:this._avatar.rotation.y=this._av2cam-this._camera.alpha+Math.PI/4;break;case this._act._walk&&this._act._turnLeft:this._avatar.rotation.y=this._av2cam-this._camera.alpha-Math.PI/4;break;case this._act._walkback&&this._act._turnRight:this._avatar.rotation.y=this._av2cam-this._camera.alpha+3*Math.PI/4;break;case this._act._walkback&&this._act._turnLeft:this._avatar.rotation.y=this._av2cam-this._camera.alpha-3*Math.PI/4;break;case this._act._walk:this._avatar.rotation.y=this._av2cam-this._camera.alpha;break;case this._act._walkback:this._avatar.rotation.y=this._av2cam-this._camera.alpha+Math.PI;break;case this._act._turnRight:this._avatar.rotation.y=this._av2cam-this._camera.alpha+Math.PI/2;break;case this._act._turnLeft:this._avatar.rotation.y=this._av2cam-this._camera.alpha-Math.PI/2}else this._avatar.rotation.y=this._av2cam-this._camera.alpha;if(s&&this._moveVector.length()>.001)if(this._avatar.moveWithCollisions(this._moveVector),this._avatar.position.y>this._avStartPos.y){const t=this._avatar.position.subtract(this._avStartPos),i=this._verticalSlope(t);i>=this._sl2?this._stepOffset>0?(0==this._vMoveTot&&this._vMovStartPos.copyFrom(this._avStartPos),this._vMoveTot=this._vMoveTot+(this._avatar.position.y-this._avStartPos.y),this._vMoveTot>this._stepOffset&&(this._vMoveTot=0,this._avatar.position.copyFrom(this._vMovStartPos),this._endFreeFall())):(this._avatar.position.copyFrom(this._avStartPos),this._endFreeFall()):(this._vMoveTot=0,i>this._sl1?(this._fallFrameCount=0,this._inFreeFall=!1):this._endFreeFall())}else if(this._avatar.position.y<this._avStartPos.y){const t=this._avatar.position.subtract(this._avStartPos);this._areVectorsEqual(t,this._moveVector,.001)?(this._inFreeFall=!0,this._fallFrameCount++,this._fallFrameCount>this._fallFrameCountMin&&(e=this._actionMap.fall)):this._verticalSlope(t)<=this._sl1?this._endFreeFall():(this._fallFrameCount=0,this._inFreeFall=!1)}else this._endFreeFall();return e}_endFreeFall(){this._movFallTime=0,this._fallFrameCount=0,this._inFreeFall=!1}_doIdle(t){if(this._grounded)return this._actionMap.idle;this._wasWalking=!1,this._wasRunning=!1,this._movFallTime=0;let i=this._actionMap.idle;if(this._fallFrameCount=0,0===t)this._freeFallDist=5;else{const i=this._idleFallTime*this._gravity;this._freeFallDist=i*t+this._gravity*t*t/2,this._idleFallTime=this._idleFallTime+t}if(this._freeFallDist<.01)return i;const s=new e.Vector3(0,-this._freeFallDist,0);if(1==this._mode||this._noRot||(this._avatar.rotation.y=this._av2cam-this._camera.alpha),this._avatar.moveWithCollisions(s),this._avatar.position.y>this._avStartPos.y||this._avatar.position.y===this._avStartPos.y)this._groundIt();else if(this._avatar.position.y<this._avStartPos.y){const t=this._avatar.position.subtract(this._avStartPos);this._areVectorsEqual(t,s,.001)||(this._verticalSlope(t)<=this._sl1?(this._groundIt(),this._avatar.position.copyFrom(this._avStartPos)):(this._unGroundIt(),i=this._actionMap.slideBack))}return i}_groundIt(){this._groundFrameCount++,this._groundFrameCount>this._groundFrameMax&&(this._grounded=!0,this._idleFallTime=0)}_unGroundIt(){this._grounded=!1,this._groundFrameCount=0}_updateTargetValue(){0==this._vMoveTot&&this._avatar.position.addToRef(this._cameraTarget,this._camera.target),this._camera.radius>this._camera.lowerRadiusLimit&&this._cameraElastic&&this._snapCamera(),this._camera.radius<=this._camera.lowerRadiusLimit?this._noFirstPerson||this._inFP||(this._avatar.visibility=0,this._camera.checkCollisions=!1,this._saveMode=this._mode,this._mode=0,this._inFP=!0):(this._inFP=!1,this._mode=this._saveMode,this._avatar.visibility=1,this._camera.checkCollisions=this._savedCameraCollision)}_snapCamera(){this._camera.position.subtractToRef(this._camera.target,this._rayDir),this._ray.origin=this._camera.target,this._ray.length=this._rayDir.length(),this._ray.direction=this._rayDir.normalize();const t=this._scene.pickWithRay(this._ray,(t=>!(t==this._avatar||!t.checkCollisions)),!0);if(t.hit)if(this._camera.checkCollisions){const i=this._camera.target.subtract(t.pickedPoint).normalize().scale(this._cameraSkin);t.pickedPoint.addToRef(i,this._camera.position)}else{const i=t.pickedPoint.subtract(this._camera.target).length();this._camera.radius=i-this._cameraSkin}}anyMovement(){return this._act._walk||this._act._walkback||this._act._turnLeft||this._act._turnRight||this._act._stepLeft||this._act._stepRight}_onKeyDown(t){if(t.key&&!t.repeat){switch(t.key.toLowerCase()){case this._actionMap.idleJump.key:this._act._jump=!0;break;case"capslock":this._act._speedMod=!this._act._speedMod;break;case"shift":this._act._speedMod=!0;break;case"up":case"arrowup":case this._actionMap.walk.key:this._act._walk=!0;break;case"left":case"arrowleft":case this._actionMap.turnLeft.key:this._act._turnLeft=!0;break;case"right":case"arrowright":case this._actionMap.turnRight.key:this._act._turnRight=!0;break;case"down":case"arrowdown":case this._actionMap.walkBack.key:this._act._walkback=!0;break;case this._actionMap.strafeLeft.key:this._act._stepLeft=!0;break;case this._actionMap.strafeRight.key:this._act._stepRight=!0}this._move=this.anyMovement()}}_onKeyUp(t){if(t.key){switch(t.key.toLowerCase()){case"shift":this._act._speedMod=!1;break;case"up":case"arrowup":case this._actionMap.walk.key:this._act._walk=!1;break;case"left":case"arrowleft":case this._actionMap.turnLeft.key:this._act._turnLeft=!1,this._isTurning=!1;break;case"right":case"arrowright":case this._actionMap.turnRight.key:this._act._turnRight=!1,this._isTurning=!1;break;case"down":case"arrowdown":case this._actionMap.walkBack.key:this._act._walkback=!1;break;case this._actionMap.strafeLeft.key:this._act._stepLeft=!1;break;case this._actionMap.strafeRight.key:this._act._stepRight=!1}this._move=this.anyMovement()}}enableKeyBoard(t){this._ekb=t;let i=this._scene.getEngine().getRenderingCanvas();t?(i.addEventListener("keyup",this._handleKeyUp,!1),i.addEventListener("keydown",this._handleKeyDown,!1)):(i.removeEventListener("keyup",this._handleKeyUp,!1),i.removeEventListener("keydown",this._handleKeyDown,!1))}walk(t){this._act._walk=t}walkBack(t){this._act._walkback=t}walkBackFast(t){this._act._walkback=t,this._act._speedMod=t}run(t){this._act._walk=t,this._act._speedMod=t}turnLeft(t){this._act._turnLeft=t,t||(this._isTurning=t)}turnLeftFast(t){this._act._turnLeft=t,t||(this._isTurning=t),this._act._speedMod=t}turnRight(t){this._act._turnRight=t,t||(this._isTurning=t)}turnRightFast(t){this._act._turnRight=t,t||(this._isTurning=t),this._act._speedMod=t}strafeLeft(t){this._act._stepLeft=t}strafeLeftFast(t){this._act._stepLeft=t,this._act._speedMod=t}strafeRight(t){this._act._stepRight=t}strafeRightFast(t){this._act._stepRight=t,this._act._speedMod=t}jump(){this._act._jump=!0}idle(){this._act.reset()}isAg(){return this._isAG}_findSkel(t){let i=this._root(t);if(i instanceof e.Mesh&&i.skeleton)return i.skeleton;let s=i.getChildMeshes(!1,(t=>!!(t instanceof e.Mesh&&t.skeleton)));return s.length>0?s[0].skeleton:null}_root(t){return null==t.parent?t:this._root(t.parent)}setAvatar(t,i=!1){let s=this._root(t);return s instanceof e.Mesh?(this._avatar=s,this._skeleton=this._findSkel(t),this._isAG=this._containsAG(t,this._scene.animationGroups,!0),this._actionMap.reset(),this._isAG||null==this._skeleton||this._checkAnimRanges(this._skeleton),this._setRHS(t),this.setFaceForward(i),!0):(console.error("Cannot move this mesh. The root node of the mesh provided is not a mesh"),!1)}getAvatar(){return this._avatar}setAvatarSkeleton(t){this._skeleton=t,this._isAG||null==this._skeleton||this._checkAnimRanges(this._skeleton)}getSkeleton(){return this._skeleton}};class a{constructor(){this._walk=!1,this._walkback=!1,this._turnRight=!1,this._turnLeft=!1,this._stepRight=!1,this._stepLeft=!1,this._jump=!1,this._speedMod=!1,this.reset()}reset(){this._walk=!1,this._walkback=!1,this._turnRight=!1,this._turnLeft=!1,this._stepRight=!1,this._stepLeft=!1,this._jump=!1,this._speedMod=!1}}class n{constructor(t,i=1,s){this.name="",this.loop=!0,this.rate=1,this.exist=!1,this.id=t,this.speed=i,this.ds=i,this.key=s,this.dk=s}reset(){this.name="",this.speed=this.ds,this.key=this.dk,this.loop=!0,this.rate=1,this.sound="",this.exist=!1}}i.ActionData=n;class h{constructor(){this.walk=new n("walk",3,"w"),this.walkBack=new n("walkBack",1.5,"s"),this.walkBackFast=new n("walkBackFast",3,"na"),this.idle=new n("idle",0,"na"),this.idleJump=new n("idleJump",6," "),this.run=new n("run",6,"na"),this.runJump=new n("runJump",6,"na"),this.fall=new n("fall",0,"na"),this.turnLeft=new n("turnLeft",Math.PI/8,"na"),this.turnLeftFast=new n("turnLeftFast",Math.PI/4,"na"),this.turnRight=new n("turnRight",Math.PI/8,"ns"),this.turnRightFast=new n("turnRightFast",Math.PI/4,"na"),this.strafeLeft=new n("strafeLeft",1.5,"a"),this.strafeLeftFast=new n("strafeLeftFast",3,"na"),this.strafeRight=new n("strafeRight",1.5,"d"),this.strafeRightFast=new n("strafeRightFast",3,"na"),this.slideBack=new n("slideBack",0,"na")}reset(){let t=Object.keys(this);for(let i of t){let t=this[i];t instanceof n&&t.reset()}}}i.ActionMap=h;class o{constructor(){this.cameraElastic=!0,this.cameraTarget=e.Vector3.Zero(),this.noFirstPerson=!1,this.topDown=!0,this.turningOff=!0,this.keyboard=!0}}i.CCSettings=o},3607:(t,i,s)=>{const e=s(573),a=s(7286);(new class{start(){const t=document.getElementById("view");this._engine=new e.Engine(t,!0);let i=new a.GameScene(this._engine,t);this._scene=i,i.enter().then((t=>{this._engine.runRenderLoop((()=>{this._scene.render()}))}))}}).start()},7286:function(t,i,s){var e=this&&this.__awaiter||function(t,i,s,e){return new(s||(s=Promise))((function(a,n){function h(t){try{r(e.next(t))}catch(t){n(t)}}function o(t){try{r(e.throw(t))}catch(t){n(t)}}function r(t){var i;t.done?a(t.value):(i=t.value,i instanceof s?i:new s((function(t){t(i)}))).then(h,o)}r((e=e.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.GameScene=void 0,s(9962),s(9520),s(9619);const a=s(573),n=s(9521);class h extends a.Scene{constructor(t,i){super(t),this._view=i}enter(){return e(this,void 0,void 0,(function*(){this.onPointerDown=t=>{0===t.button&&this.getEngine().enterPointerlock(),1===t.button&&this.getEngine().exitPointerlock()},this.ambientColor=a.Color3.Black(),this.clearColor=new a.Color4(0,0,0);let t=new a.SpotLight("spot",new a.Vector3(0,1,0),new a.Vector3(1,0,0),a.Angle.FromDegrees(60).radians(),90,this);t.intensity=40;let i=yield a.SceneLoader.ImportMeshAsync("","./models/","flashlight.glb",this),s=i.meshes[0];i=yield a.SceneLoader.ImportMeshAsync("","./models/","Prototype_Level.glb",this),i.meshes.map((t=>{t.checkCollisions=!0}));let e=a.MeshBuilder.CreateCapsule("capsule",{height:3,radius:1},this);e.position.x=8,e.position.y=4,e.ellipsoid=new a.Vector3(1.3,1,1.5);var h=3*Math.PI/2-e.rotation.y,o=Math.PI/2.5,r=new a.Vector3(e.position.x,e.position.y+1.5,e.position.z),_=new a.ArcRotateCamera("ArcRotateCamera",h,o,1,r,this);_.angularSensibilityX=4e3,_.angularSensibilityY=4e3,_.minZ=.6,_.keysLeft=[],_.keysRight=[],_.keysUp=[],_.keysDown=[],_.wheelPrecision=0,_.checkCollisions=!1,_.lowerRadiusLimit=2,_.upperRadiusLimit=20,_.attachControl(this._view,!1),s.scaling.set(.6,.6,.6),s.rotate(a.Axis.Y,a.Angle.FromDegrees(-95).radians(),a.Space.LOCAL);let c=new a.TransformNode("transformNode");c.parent=_,c.scaling=new a.Vector3(.15,.15,.15),c.position=new a.Vector3(.4,-.45,1.25),s.parent=c;let l=new n.CharacterController(e,_,this,null,!0);l.setMode(0),l.setCameraTarget(new a.Vector3(0,1.5,0)),l.setNoFirstPerson(!1),l.setStepOffset(.4),l.setSlopeLimit(30,60),l.start(),this.onBeforeRenderObservable.add((()=>{t.position=_.position,t.setDirectionToTarget(_.getFrontPosition(1))}))}))}}i.GameScene=h}},s={};function e(t){var a=s[t];if(void 0!==a)return a.exports;var n=s[t]={exports:{}};return i[t].call(n.exports,n,n.exports,e),n.exports}e.m=i,t=[],e.O=(i,s,a,n)=>{if(!s){var h=1/0;for(c=0;c<t.length;c++){for(var[s,a,n]=t[c],o=!0,r=0;r<s.length;r++)(!1&n||h>=n)&&Object.keys(e.O).every((t=>e.O[t](s[r])))?s.splice(r--,1):(o=!1,n<h&&(h=n));if(o){t.splice(c--,1);var _=a();void 0!==_&&(i=_)}}return i}n=n||0;for(var c=t.length;c>0&&t[c-1][2]>n;c--)t[c]=t[c-1];t[c]=[s,a,n]},e.d=(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),e.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={179:0};e.O.j=i=>0===t[i];var i=(i,s)=>{var a,n,[h,o,r]=s,_=0;if(h.some((i=>0!==t[i]))){for(a in o)e.o(o,a)&&(e.m[a]=o[a]);if(r)var c=r(e)}for(i&&i(s);_<h.length;_++)n=h[_],e.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return e.O(c)},s=self.webpackChunkbabylonjs_typescript_starter=self.webpackChunkbabylonjs_typescript_starter||[];s.forEach(i.bind(null,0)),s.push=i.bind(null,s.push.bind(s))})();var a=e.O(void 0,[520],(()=>e(3607)));a=e.O(a)})();